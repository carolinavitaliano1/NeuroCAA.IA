<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß† NeuroCAA</title>

  <!-- PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    h1 { text-align: center; }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }

    button {
      padding: 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }

    .generate { background: #667eea; color: white; }
    .save { background: #48bb78; color: white; }
    .pdf { background: #4299e1; color: white; }
    .clear { background: #f56565; color: white; }

    .board {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .cell {
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
    }

    .cell img {
      max-width: 80px;
      max-height: 80px;
    }

    .history {
      margin-top: 25px;
    }

    .history-item {
      background: #f1f5f9;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 6px;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #48bb78;
      color: white;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>üß† NeuroCAA</h1>

  <div class="input-group">
    <input id="phraseInput" placeholder="Digite a frase..." />
    <button class="generate" onclick="generateBoard()">Gerar</button>
  </div>

  <input id="boardTitle" placeholder="T√≠tulo da prancha (opcional)" style="width:100%; padding:8px;" />

  <div id="board" class="board"></div>

  <div style="margin-top:15px; display:flex; gap:10px;">
    <button class="save" onclick="saveBoard()">üíæ Salvar</button>
    <button class="pdf" onclick="exportBoardToPDF()">üìÑ PDF</button>
    <button class="clear" onclick="clearBoard()">üóëÔ∏è Limpar</button>
  </div>

  <div class="history">
    <h3>üìö Hist√≥rico</h3>
    <div id="historyList"></div>
  </div>
</div>

<script>
const API = 'https://api.arasaac.org/api/pictograms/pt/search/';
let currentBoard = [];

const CAA_COLORS = [
  { name:'Amarelo', color:'#FDE047', label:'Pessoas / Pronomes' },
  { name:'Verde', color:'#86EFAC', label:'Verbos / A√ß√µes' },
  { name:'Azul', color:'#93C5FD', label:'Adjetivos' },
  { name:'Laranja', color:'#FDBA74', label:'Substantivos' },
  { name:'Rosa', color:'#F9A8D4', label:'Express√µes sociais' },
  { name:'Branco', color:'#FFFFFF', label:'Artigos' },
  { name:'Roxo', color:'#C4B5FD', label:'Preposi√ß√µes' },
  { name:'Marrom', color:'#D6B28A', label:'Adv√©rbios' }
];

function toast(msg, error=false) {
  const t = document.createElement('div');
  t.className = 'toast';
  if(error) t.style.background='#f56565';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3000);
}

function saveLS(data){ localStorage.setItem('pranchas',JSON.stringify(data)); }
function loadLS(){ return JSON.parse(localStorage.getItem('pranchas')||'[]'); }

async function generateBoard(){
  const phrase = phraseInput.value.trim();
  if(!phrase) return;

  currentBoard = [];
  for(const word of phrase.split(/\s+/)){
    let data=[];
    try{
      const res=await fetch(API+encodeURIComponent(word));
      data=await res.json();
    }catch{}
    const pic=data[0];
    currentBoard.push({
      word,
      img: pic ? `https://static.arasaac.org/pictograms/${pic._id}/${pic._id}_300.png` : null,
      customText:null,
      bgColor:'#ffffff',
      borderColor:'#e2e8f0'
    });
  }
  renderBoard();
}

function renderBoard(){
  board.innerHTML='';
  const title=boardTitle.value.trim();
  if(title){
    const t=document.createElement('div');
    t.textContent=title;
    t.style.fontWeight='700';
    t.style.gridColumn='1/-1';
    t.style.textAlign='center';
    board.appendChild(t);
  }

  currentBoard.forEach((item,i)=>{
    const cell=document.createElement('div');
    cell.className='cell';
    cell.style.background=item.bgColor;
    cell.style.border=`2px solid ${item.borderColor}`;
    cell.innerHTML=`
      ${item.img?`<img src="${item.img}">`:''}
      <div>${item.customText||item.word}</div>`;
    cell.onclick=()=>openQuickEditModal(i);
    board.appendChild(cell);
  });
}
<script>
async function openQuickEditModal(index) {
  const item = currentBoard[index];

  let targetColor = null; // controla se estamos editando fundo ou borda

  const overlay = document.createElement('div');
  overlay.style.cssText = `
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
  `;

  const modal = document.createElement('div');
  modal.style.cssText = `
    background:#fff;
    padding:20px;
    border-radius:12px;
    max-width:420px;
    width:100%;
  `;

  modal.innerHTML = `
    <h3>‚úèÔ∏è Editar "${item.word}"</h3>

    <label>Texto:</label>
    <input id="editText" value="${item.customText || item.word}"
      style="width:100%; padding:8px; margin-bottom:10px"/>

    <label>üé® Fundo:</label>
    <button id="btnBg" style="width:100%; padding:8px; margin-bottom:8px">
      Selecionar cor sem√¢ntica
    </button>

    <label>üñçÔ∏è Borda:</label>
    <button id="btnBorder" style="width:100%; padding:8px; margin-bottom:10px">
      Selecionar cor sem√¢ntica
    </button>

    <div id="colorPanel" style="display:none; margin:10px 0"></div>

    <button id="searchPic" style="
  display:flex;
  align-items:center;
  gap:6px;
  padding:8px 10px;
  cursor:pointer;
">
  <span style="font-size:16px">üîç</span>
  <span>Buscar outro pictograma</span>
</button>
    <br><br>
