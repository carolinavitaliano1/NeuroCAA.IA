!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ§  NeuroCAA â€“ Prancha Compartilhada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #f8fafc;
      padding: 20px;
    }

    h1 {
      text-align: center;<
      margin-bottom: 20px;
    }

    .board {
      display: grid;
      gap: 10px;
      background: white;
      padding: 16px;
      border-radius: 12px;
      max-width: 1000px;
      margin: auto;
    }

    .cell {
      background: #fff;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }

    .cell img {
      max-width: 100%;
      height: auto;
    }

    .cell div {
      font-weight: 600;
      margin-top: 6px;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>
  <h1>ðŸ§  Prancha Compartilhada</h1>
  <div id="board" class="board"></div>

  <script>
    // ðŸ” Firebase config (o MESMO do index)
    const firebaseConfig = {
      apiKey: "AIzaSyDPwPgsjw0bUrwfvt7242MGEekOdKuT1_8",
      authDomain: "neurocaa-1460e.firebaseapp.com",
      projectId: "neurocaa-1460e",
      storageBucket: "neurocaa-1460e.firebasestorage.app",
      messagingSenderId: "788969719580",
      appId: "1:788969719580:web:fce897a25a2f46dcdadcd9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ðŸ”Ž Pega o shareId da URL
    const params = new URLSearchParams(window.location.search);
    const shareId = params.get("share");

    if (!shareId) {
      alert("Link invÃ¡lido.");
    } else {
      loadSharedBoard(shareId);
    }

    async function loadSharedBoard(shareId) {
      const snapshot = await db.ref("boards").get();
      const data = snapshot.val();

      if (!data) {
        alert("Prancha nÃ£o encontrada.");
        return;
      }

      let foundBoard = null;

      // ðŸ” percorre todos os usuÃ¡rios e pranchas
      Object.values(data).forEach(userBoards => {
        Object.values(userBoards).forEach(board => {
          if (board.shareId === shareId) {
            foundBoard = board;
          }
        });
      });

      if (!foundBoard) {
        alert("Prancha nÃ£o encontrada.");
        return;
      }

      renderBoard(foundBoard);
    }

    function renderBoard(boardData) {
      const board = document.getElementById("board");
      board.innerHTML = "";

      if (boardData.config?.columnsCount) {
        board.style.gridTemplateColumns =
          `repeat(${boardData.config.columnsCount}, 1fr)`;
      }

      if (boardData.config?.cellGap !== null) {
        board.style.gap = `${boardData.config.cellGap}px`;
      }

      if (boardData.config?.boardBorderColor) {
        board.style.border = `4px solid ${boardData.config.boardBorderColor}`;
      }

      // ðŸ·ï¸ tÃ­tulo
      if (boardData.title) {
        const header = document.createElement("div");
        header.style.gridColumn = "1 / -1";
        header.style.textAlign = "center";
        header.style.fontSize = "32px";
        header.style.fontWeight = "800";
        header.style.padding = "16px";
        header.innerText = boardData.title;

        if (boardData.config?.headerColor) {
          header.style.background = boardData.config.headerColor;
          header.style.borderRadius = "12px";
        }

        board.appendChild(header);
      }

      // ðŸ§© cÃ©lulas
      boardData.board.forEach(item => {
        const cell = document.createElement("div");
        cell.className = "cell";

        cell.style.background =
          item.bgColor || boardData.config?.cellBgColor || "#fff";

        cell.style.border =
          `2px solid ${item.borderColor || boardData.config?.cellBorderColor || "#e2e8f0"}`;

        cell.innerHTML = `
          ${item.img ? `<img src="${item.img}" />` : ""}
          <div>${item.customText || item.word}</div>
        `;

        board.appendChild(cell);
      });
    }
  </script>
</body>
</html>
